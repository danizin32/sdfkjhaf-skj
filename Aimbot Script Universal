--[[ CONFIGURA√á√ïES ]]
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local config = {
    esp = false,
    aimbot = false,
    fovSize = 150
}

local function saveConfig()
    pcall(function()
        writefile("PL_Config.json", game:GetService("HttpService"):JSONEncode(config))
    end)
end

local function loadConfig()
    pcall(function()
        if isfile("PL_Config.json") then
            local data = readfile("PL_Config.json")
            local decoded = game:GetService("HttpService"):JSONDecode(data)
            for k, v in pairs(decoded) do
                config[k] = v
            end
        end
    end)
end
loadConfig()

--[[ INTERFACE ]]
local ui = Instance.new("ScreenGui", game.CoreGui)
ui.Name = "PL_Interface"
local dragFrame = Instance.new("Frame", ui)
dragFrame.Size = UDim2.new(0, 300, 0, 400)
dragFrame.Position = UDim2.new(0.05, 0, 0.2, 0)
dragFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
dragFrame.BorderSizePixel = 0
dragFrame.Active = true
dragFrame.Draggable = true

local UICorner = Instance.new("UICorner", dragFrame)
UICorner.CornerRadius = UDim.new(0, 6)

local title = Instance.new("TextLabel", dragFrame)
title.Size = UDim2.new(1, 0, 0, 40)
title.Text = "Painel - Aimbot & ESP"
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.TextColor3 = Color3.new(1, 1, 1)

local minimize = Instance.new("TextButton", dragFrame)
minimize.Size = UDim2.new(0, 30, 0, 30)
minimize.Position = UDim2.new(1, -35, 0, 5)
minimize.Text = "-"
minimize.Font = Enum.Font.GothamBold
minimize.TextColor3 = Color3.new(1, 1, 1)
minimize.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
Instance.new("UICorner", minimize)

local container = Instance.new("Frame", dragFrame)
container.Position = UDim2.new(0, 0, 0, 40)
container.Size = UDim2.new(1, 0, 1, -40)
container.BackgroundTransparency = 1

local toggles = {}

local y = 10
local function createToggle(name, setting, icon)
    local btn = Instance.new("TextButton", container)
    btn.Size = UDim2.new(0.9, 0, 0, 40)
    btn.Position = UDim2.new(0.05, 0, 0, y)
    btn.Text = icon .. " " .. name .. ": " .. (config[setting] and "ON" or "OFF")
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.BackgroundColor3 = config[setting] and Color3.fromRGB(0, 120, 255) or Color3.fromRGB(60, 60, 60)
    btn.Font = Enum.Font.GothamBold
    btn.TextScaled = true
    Instance.new("UICorner", btn)
    y += 50

    btn.MouseButton1Click:Connect(function()
        config[setting] = not config[setting]
        btn.Text = icon .. " " .. name .. ": " .. (config[setting] and "ON" or "OFF")
        btn.BackgroundColor3 = config[setting] and Color3.fromRGB(0, 120, 255) or Color3.fromRGB(60, 60, 60)
        saveConfig()
    end)

    table.insert(toggles, btn)
end

createToggle("ESP", "esp", "üëÅ")
createToggle("Aimbot", "aimbot", "üéØ")

-- FOV ajustes
local fovLabel = Instance.new("TextLabel", container)
fovLabel.Size = UDim2.new(1, 0, 0, 30)
fovLabel.Position = UDim2.new(0, 0, 0, y)
fovLabel.Text = "FOV: " .. config.fovSize
fovLabel.Font = Enum.Font.Gotham
fovLabel.TextColor3 = Color3.new(1,1,1)
fovLabel.BackgroundTransparency = 1
fovLabel.TextScaled = true
y += 35

local plus = Instance.new("TextButton", container)
plus.Size = UDim2.new(0.42, 0, 0, 35)
plus.Position = UDim2.new(0.05, 0, 0, y)
plus.Text = "+"
plus.Font = Enum.Font.Gotham
plus.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
plus.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", plus)

local minus = plus:Clone()
minus.Text = "-"
minus.Position = UDim2.new(0.53, 0, 0, y)
minus.Parent = container

plus.Parent = container

plus.MouseButton1Click:Connect(function()
    config.fovSize += 20
    fovLabel.Text = "FOV: " .. config.fovSize
    saveConfig()
end)
minus.MouseButton1Click:Connect(function()
    config.fovSize = math.max(20, config.fovSize - 20)
    fovLabel.Text = "FOV: " .. config.fovSize
    saveConfig()
end)

y += 45

-- Cr√©ditos
local credit = Instance.new("TextLabel", container)
credit.Size = UDim2.new(1, 0, 0, 30)
credit.Position = UDim2.new(0, 0, 0, y)
credit.Text = "Script por voc√™ + ChatGPT"
credit.TextColor3 = Color3.fromRGB(200, 200, 200)
credit.BackgroundTransparency = 1
credit.Font = Enum.Font.Gotham
credit.TextScaled = true

-- Minimize
local minimized = false
minimize.MouseButton1Click:Connect(function()
    minimized = not minimized
    local goal = minimized and UDim2.new(0, 300, 0, 40) or UDim2.new(0, 300, 0, 400)
    dragFrame:TweenSize(goal, Enum.EasingDirection.Out, Enum.EasingStyle.Sine, 0.25, true)
    container.Visible = not minimized
end)

--[[ ESP E AIMBOT ]]
local function createESP(player)
    if player == LocalPlayer then return end
    local adornee = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not adornee then return end

    local box = Instance.new("BoxHandleAdornment")
    box.Name = "ESPBox"
    box.Adornee = adornee
    box.AlwaysOnTop = true
    box.ZIndex = 5
    box.Size = Vector3.new(4, 6, 1)
    box.Transparency = 0.5
    box.Color3 = player.TeamColor.Color
    box.Parent = adornee
end

local function updateESP()
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Team ~= LocalPlayer.Team and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            if config.esp and not plr.Character:FindFirstChild("ESPBox") then
                createESP(plr)
            elseif not config.esp and plr.Character:FindFirstChild("ESPBox") then
                plr.Character.ESPBox:Destroy()
            end
        end
    end
end

local function getClosestTarget()
    local closest, shortest = nil, config.fovSize
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Team ~= LocalPlayer.Team and plr.Character and plr.Character:FindFirstChild("Head") then
            local pos, visible = Camera:WorldToViewportPoint(plr.Character.Head.Position)
            if visible then
                local dist = (Vector2.new(pos.X, pos.Y) - UserInputService:GetMouseLocation()).Magnitude
                if dist < shortest then
                    shortest = dist
                    closest = plr
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    if config.esp then updateESP() end
    if config.aimbot then
        local target = getClosestTarget()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Character.Head.Position)
        end
    end
end)
