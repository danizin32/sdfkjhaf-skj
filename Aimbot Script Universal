--[[
Interface estilo "fantasia" com Aimbot, ESP e FOV ajustável
TextBox define valor do FOV diretamente
Botões de controle e título no topo
--]]

-- SERVIÇOS
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- VARIÁVEIS
local AimbotEnabled = false
local ESPEnabled = false
local FOVRadius = 100

-- INTERFACE
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "CustomESP_UI"

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 300, 0, 360)
frame.Position = UDim2.new(0.5, -150, 0.5, -180)
frame.BackgroundColor3 = Color3.fromRGB(25, 0, 0)
frame.BorderSizePixel = 4
frame.BorderColor3 = Color3.fromRGB(255, 0, 0)
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 40)
title.Text = "Menu de Testes ESP/Aimbot"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
title.BorderSizePixel = 0

local layout = Instance.new("UIListLayout", frame)
layout.Padding = UDim.new(0, 6)
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Top

title.LayoutOrder = 0

local function createButton(text, callback)
	local button = Instance.new("TextButton", frame)
	button.Size = UDim2.new(0, 260, 0, 32)
	button.BackgroundColor3 = Color3.fromRGB(30, 0, 0)
	button.TextColor3 = Color3.fromRGB(255, 255, 255)
	button.Font = Enum.Font.Gotham
	button.TextSize = 14
	button.Text = text
	button.BorderSizePixel = 2
	button.BorderColor3 = Color3.fromRGB(120, 0, 0)

	local active = false
	button.MouseButton1Click:Connect(function()
		active = not active
		button.BackgroundColor3 = active and Color3.fromRGB(150, 0, 0) or Color3.fromRGB(30, 0, 0)
		callback(active)
	end)
end

-- TextBox para FOV
local fovBox = Instance.new("TextBox", frame)
fovBox.Size = UDim2.new(0, 260, 0, 32)
fovBox.PlaceholderText = "Digite o valor do FOV (ex: 120)"
fovBox.Text = tostring(FOVRadius)
fovBox.TextColor3 = Color3.fromRGB(255, 255, 255)
fovBox.BackgroundColor3 = Color3.fromRGB(20, 0, 0)
fovBox.Font = Enum.Font.Gotham
fovBox.TextSize = 14
fovBox.BorderColor3 = Color3.fromRGB(100, 0, 0)

-- Botões de FOV
local increaseFOV = Instance.new("TextButton", frame)
increaseFOV.Size = UDim2.new(0, 260, 0, 28)
increaseFOV.Text = "Aumentar FOV"
increaseFOV.Font = Enum.Font.GothamBold
increaseFOV.TextSize = 14
increaseFOV.TextColor3 = Color3.fromRGB(255, 255, 255)
increaseFOV.BackgroundColor3 = Color3.fromRGB(30, 0, 0)
increaseFOV.BorderColor3 = Color3.fromRGB(100, 0, 0)
increaseFOV.MouseButton1Click:Connect(function()
	FOVRadius = math.min(FOVRadius + 10, 500)
	fovBox.Text = tostring(FOVRadius)
end)

local decreaseFOV = Instance.new("TextButton", frame)
decreaseFOV.Size = UDim2.new(0, 260, 0, 28)
decreaseFOV.Text = "Diminuir FOV"
decreaseFOV.Font = Enum.Font.GothamBold
decreaseFOV.TextSize = 14
decreaseFOV.TextColor3 = Color3.fromRGB(255, 255, 255)
decreaseFOV.BackgroundColor3 = Color3.fromRGB(30, 0, 0)
decreaseFOV.BorderColor3 = Color3.fromRGB(100, 0, 0)
decreaseFOV.MouseButton1Click:Connect(function()
	FOVRadius = math.max(FOVRadius - 10, 10)
	fovBox.Text = tostring(FOVRadius)
end)

-- CRÉDITOS
local credit = Instance.new("TextLabel", frame)
credit.Size = UDim2.new(0, 260, 0, 24)
credit.Text = "Criado por ChatGPT | Testes autorizados"
credit.TextColor3 = Color3.fromRGB(255, 0, 0)
credit.Font = Enum.Font.Gotham
credit.TextSize = 12
credit.BackgroundTransparency = 1

-- FOV CIRCLE
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 1
fovCircle.Filled = false
fovCircle.Transparency = 1
fovCircle.Color = Color3.fromRGB(255, 0, 0)
fovCircle.NumSides = 60
fovCircle.Radius = FOVRadius
fovCircle.Visible = true

-- FUNÇÕES
local function getClosestEnemy()
	local shortestDist = FOVRadius
	local closest = nil

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Team ~= LocalPlayer.Team and player.Character and player.Character:FindFirstChild("Head") then
			local pos, visible = Camera:WorldToViewportPoint(player.Character.Head.Position)
			if visible then
				local dist = (Vector2.new(pos.X, pos.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
				if dist < shortestDist then
					shortestDist = dist
					closest = player
				end
			end
		end
	end
	return closest
end

-- ESP DRAWING
local espBoxes = {}
local function updateESP()
	for _, box in pairs(espBoxes) do
		box:Remove()
	end
	espBoxes = {}

	if not ESPEnabled then return end

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Team ~= LocalPlayer.Team and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			local root = player.Character.HumanoidRootPart
			local pos, visible = Camera:WorldToViewportPoint(root.Position)
			if visible then
				local box = Drawing.new("Square")
				box.Size = Vector2.new(60, 90)
				box.Position = Vector2.new(pos.X - 30, pos.Y - 90)
				box.Color = Color3.fromRGB(255, 0, 0)
				box.Thickness = 2
				box.Visible = true
				table.insert(espBoxes, box)
			end
		end
	end
end

-- LOOP
RunService.RenderStepped:Connect(function()
	local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
	fovCircle.Position = center
	fovCircle.Radius = FOVRadius

	local inputFOV = tonumber(fovBox.Text)
	if inputFOV then
		FOVRadius = math.clamp(inputFOV, 10, 500)
	end

	if AimbotEnabled then
		local enemy = getClosestEnemy()
		if enemy and enemy.Character and enemy.Character:FindFirstChild("Head") then
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, enemy.Character.Head.Position)
		end
	end

	updateESP()
end)

-- BOTÕES FUNCIONAIS
createButton("Ativar Aimbot", function(active)
	AimbotEnabled = active
end)

createButton("Ativar ESP", function(active)
	ESPEnabled = active
end)
