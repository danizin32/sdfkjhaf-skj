--[[ 
âœ… SCRIPT DE TESTE PARA PRISON LIFE (MOBILE)
ðŸŽ¯ Aimbot com FOV ajustÃ¡vel
ðŸ”µ ESP com Team Check (caixa azul/vermelha), nome e distÃ¢ncia
ðŸ“¦ Interface com Ã­cones, animaÃ§Ãµes, arrastÃ¡vel, salvamento
ðŸ“Œ Para uso de testes/autorizados
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Config
local config = {
    esp = true,
    aimbot = true,
    fovSize = 120
}

-- Salvar/Carregar Config
local function saveConfig()
    pcall(function()
        writefile("aimesp_config.txt", game:GetService("HttpService"):JSONEncode(config))
    end)
end

local function loadConfig()
    pcall(function()
        local data = readfile("aimesp_config.txt")
        local decoded = game:GetService("HttpService"):JSONDecode(data)
        for k, v in pairs(decoded) do config[k] = v end
    end)
end

loadConfig()

-- Criar UI
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.ResetOnSpawn = false

local dragFrame = Instance.new("Frame", gui)
dragFrame.Position = UDim2.new(0.1, 0, 0.1, 0)
dragFrame.Size = UDim2.new(0, 250, 0, 0)
dragFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
dragFrame.BorderSizePixel = 0
dragFrame.Active = true
dragFrame.Draggable = true

local UICorner = Instance.new("UICorner", dragFrame)
UICorner.CornerRadius = UDim.new(0, 6)

local UIStroke = Instance.new("UIStroke", dragFrame)
UIStroke.Color = Color3.fromRGB(0, 120, 255)
UIStroke.Thickness = 2

-- TÃ­tulo
local title = Instance.new("TextLabel", dragFrame)
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.Text = "Aimbot + ESP"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextScaled = true

local buttons = {}
local y = 40

-- FunÃ§Ã£o para criar toggles com Ã­cone
local function createToggle(name, setting, icon)
    local btn = Instance.new("TextButton", dragFrame)
    btn.Size = UDim2.new(0.9, 0, 0, 40)
    btn.Position = UDim2.new(0.05, 0, 0, y)
    btn.Text = icon .. " " .. name .. ": " .. (config[setting] and "ON" or "OFF")
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.BackgroundColor3 = config[setting] and Color3.fromRGB(0, 120, 255) or Color3.fromRGB(40, 40, 40)
    btn.Font = Enum.Font.GothamBold
    btn.TextScaled = true
    Instance.new("UICorner", btn)

    btn.MouseButton1Click:Connect(function()
        config[setting] = not config[setting]
        btn.Text = icon .. " " .. name .. ": " .. (config[setting] and "ON" or "OFF")
        btn.BackgroundColor3 = config[setting] and Color3.fromRGB(0, 120, 255) or Color3.fromRGB(40, 40, 40)
        saveConfig()
    end)

    table.insert(buttons, btn)
    y += 50
end

createToggle("ESP", "esp", "ðŸ§­")
createToggle("Aimbot", "aimbot", "ðŸŽ¯")

-- FOV Controles
local fovLabel = Instance.new("TextLabel", dragFrame)
fovLabel.Size = UDim2.new(1, 0, 0, 30)
fovLabel.Position = UDim2.new(0, 0, 0, y)
fovLabel.BackgroundTransparency = 1
fovLabel.Text = "FOV: " .. config.fovSize
fovLabel.TextColor3 = Color3.new(1,1,1)
fovLabel.Font = Enum.Font.Gotham
fovLabel.TextScaled = true
y += 35

local plus = Instance.new("TextButton", dragFrame)
plus.Size = UDim2.new(0.45, 0, 0, 30)
plus.Position = UDim2.new(0.05, 0, 0, y)
plus.Text = "+"
plus.Font = Enum.Font.GothamBold
plus.TextScaled = true
plus.TextColor3 = Color3.new(1,1,1)
plus.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
Instance.new("UICorner", plus)

local minus = plus:Clone()
minus.Text = "-"
minus.Position = UDim2.new(0.5, 0, 0, y)
minus.Parent = dragFrame
plus.Parent = dragFrame

plus.MouseButton1Click:Connect(function()
    config.fovSize += 20
    fovLabel.Text = "FOV: " .. config.fovSize
    saveConfig()
end)
minus.MouseButton1Click:Connect(function()
    config.fovSize = math.max(20, config.fovSize - 20)
    fovLabel.Text = "FOV: " .. config.fovSize
    saveConfig()
end)

y += 40

-- CrÃ©ditos
local credit = Instance.new("TextLabel", dragFrame)
credit.Size = UDim2.new(1, 0, 0, 30)
credit.Position = UDim2.new(0, 0, 0, y)
credit.BackgroundTransparency = 1
credit.Text = "Criado por VocÃª e ChatGPT"
credit.TextColor3 = Color3.fromRGB(180, 180, 180)
credit.Font = Enum.Font.Gotham
credit.TextScaled = true
y += 35

-- Ajustar altura total da interface
dragFrame.Size = UDim2.new(0, 250, 0, y + 10)

-- Minimizar
local minimized = false
local toggleBtn = Instance.new("TextButton", dragFrame)
toggleBtn.Size = UDim2.new(0, 25, 0, 25)
toggleBtn.Position = UDim2.new(1, -30, 0, 5)
toggleBtn.Text = "-"
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextScaled = true
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Instance.new("UICorner", toggleBtn)

toggleBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    for _, child in ipairs(dragFrame:GetChildren()) do
        if child ~= toggleBtn and child ~= title then
            child.Visible = not minimized
        end
    end
    dragFrame.Size = minimized and UDim2.new(0, 250, 0, 40) or UDim2.new(0, 250, 0, y + 10)
    toggleBtn.Text = minimized and "+" or "-"
end)

-- ESP & Aimbot FunÃ§Ã£o
local function isEnemy(plr)
    return plr.Team ~= LocalPlayer.Team
end

local function getClosest()
    local closest, dist = nil, math.huge
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and isEnemy(plr) and plr.Character and plr.Character:FindFirstChild("Head") then
            local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(plr.Character.Head.Position)
            local mag = (Vector2.new(pos.X, pos.Y) - Vector2.new(Mouse.X, Mouse.Y)).Magnitude
            if onScreen and mag < config.fovSize and mag < dist then
                dist = mag
                closest = plr
            end
        end
    end
    return closest
end

-- FOV Circle
local circle = Drawing.new("Circle")
circle.Visible = true
circle.Color = Color3.fromRGB(0, 120, 255)
circle.Thickness = 1
circle.Radius = config.fovSize
circle.Filled = false

RunService.RenderStepped:Connect(function()
    circle.Position = Vector2.new(Mouse.X, Mouse.Y)
    circle.Radius = config.fovSize

    if config.aimbot then
        local target = getClosest()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            workspace.CurrentCamera.CFrame = CFrame.new(workspace.CurrentCamera.CFrame.Position, target.Character.Head.Position)
        end
    end
end)

-- ESP Boxes
local function createESP(plr)
    local box = Drawing.new("Square")
    box.Thickness = 1
    box.Filled = false
    local nameText = Drawing.new("Text")
    nameText.Size = 14
    nameText.Center = true
    nameText.Outline = true
    nameText.Color = Color3.fromRGB(255,255,255)

    RunService.RenderStepped:Connect(function()
        local char = plr.Character
        if config.esp and char and char:FindFirstChild("HumanoidRootPart") and isEnemy(plr) then
            local root = char.HumanoidRootPart
            local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(root.Position)
            local scale = 3
            if onScreen then
                box.Visible = true
                box.Position = Vector2.new(pos.X - 25, pos.Y - 50)
                box.Size = Vector2.new(50, 100)
                box.Color = plr.TeamColor.Color

                nameText.Visible = true
                nameText.Position = Vector2.new(pos.X, pos.Y - 60)
                nameText.Text = plr.Name .. " [" .. math.floor((root.Position - workspace.CurrentCamera.CFrame.Position).Magnitude) .. "m]"
            else
                box.Visible = false
                nameText.Visible = false
            end
        else
            box.Visible = false
            nameText.Visible = false
        end
    end)
end

for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= LocalPlayer then createESP(plr) end
end

Players.PlayerAdded:Connect(function(plr)
    if plr ~= LocalPlayer then
        plr.CharacterAdded:Connect(function()
            wait(1)
            createESP(plr)
        end)
    end
end)
